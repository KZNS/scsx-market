<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css"
        integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <title>Staff Management</title>
</head>

<body>
    <style>
        .input{width:100px;overflow:hidden}
    </style>
    <form method="GET">
        Staff ID: <input type="number" name="staff_id" class="input"/>
        Name: <input type="text" name="name" class="input"/>
        Level: <input type="text" name="level" class="input"/>
        Telephone: <input type="text" name="telephone" class="input"/>
        Salary: <input type="text" name="salary" class="input"/>
        Comment: <input type="text" name="comment" class="input"/>
        <input type="submit" name="submit"/>
    </form>
    <a href="{{url_for('manage.staff_add')}}">
        <button>增加员工</button>
    </a>
    <table>
        <tr>
            <th>Staff ID</th>
            <th>Name</th>
            <th>Level</th>
            <th>Telephone</th>
            <th>Salary</th>
            <th>Comment</th>
        </tr>
        {% for item in data %}
        <tr>
            <td>{{item.staff_id}}</td>
            <td>{{item.name}}</td>
            <td>{{item.level}}</td>
            <td>{{item.telephone}}</td>
            <td>{{item.salary}}</td>
            <td>{{item.comment if item.comment else ''}}</td>
            <td>
                <button onclick="ondelete({{item.id}})">删除</button>
            </td>
        </tr>
        {% endfor %}
    </table>
    
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.min.js"></script>

    <script>
        function ondelete(id)
        {
            $.ajax({
                url: '/manage/staff/del/' + id,
                type: 'DELETE',
                success: function(result) {
                    console.log(result)
                    if (result === 'succeed')
                    {
                        window.location.href = "{{url_for('manage.staff_query', result='删除成功')}}"
                    }
                    else if (result === 'fail')
                    {
                        window.location.href = "{{url_for('manage.staff_query', result='删除失败')}}"
                    }
                },
                error: function(result) {
                    console.log(result)
                }
            });
        }

    </script>

</body>

</html>
